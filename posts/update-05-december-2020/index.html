<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="SwiftWasm Blog"/><link rel="canonical" href="https://blog.swiftwasm.org/posts/update-05-december-2020"/><meta name="twitter:url" content="https://blog.swiftwasm.org/posts/update-05-december-2020"/><meta name="og:url" content="https://blog.swiftwasm.org/posts/update-05-december-2020"/><title>What's new in SwiftWasm #5 | SwiftWasm Blog</title><meta name="twitter:title" content="What's new in SwiftWasm #5 | SwiftWasm Blog"/><meta name="og:title" content="What's new in SwiftWasm #5 | SwiftWasm Blog"/><meta name="description" content="An update on what happened in the SwiftWasm ecosystem during December 2020."/><meta name="twitter:description" content="An update on what happened in the SwiftWasm ecosystem during December 2020."/><meta name="og:description" content="An update on what happened in the SwiftWasm ecosystem during December 2020."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="/splash.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="https://fonts.googleapis.com/css2?family=Lora:wght@600&display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to SwiftWasm Blog"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">SwiftWasm Blog</a></div></header><div class="wrapper"><article><p><small>Published on <time datetime="2021-01-11T14:34:00Z">January 11, 2021.</time></small></p><div class="content"><h1>What's new in SwiftWasm #5</h1><p>Happy New Year everyone! Here's a digest of what happened with <a href="https://swiftwasm.org">SwiftWasm</a> in December of 2020, published with a slight delay (it's 2021 already after all ðŸ˜…).</p><h2>SwiftWasm community</h2><p>One thing we forgot to mention in our November update is that the SwiftWasm community now has <a href="https://discord.gg/ashJW8T8yp">its own Discord server</a>. In case you prefer Slack to Discord, we recommend you to join the <code>#webassembly</code> channel in <a href="https://swift-package-manager.herokuapp.com/">the SwiftPM Slack workspace</a>.</p><p>In December we saw a lot of projects built with SwiftWasm shared by the community. Here a few most noteworthy:</p><ul><li><a href="https://github.com/nerdsupremacist/memes">An online Multi-Player Meme Party Game written in Swift</a>, using <a href="https://vapor.codes/">Vapor</a> for backend and SwiftWasm with <a href="https://tokamak.dev">Tokamak</a> for frontend, built by <a href="https://github.com/nerdsupremacist">Mathias Quintero</a>.</li><li><a href="https://garrepi.dev/tic-tac-toe/">Tic-tac-toe game</a> <a href="https://github.com/johngarrett/tic-tac-toe">built with SwiftWasm</a> by <a href="https://github.com/johngarrett">John Garrett</a>.</li><li><a href="https://expressflow.com/blog/posts/webassembly-example-with-react-and-swiftwasm">WebAssembly example with React and SwiftWasm</a> by <a href="https://github.com/martinvasko">Martin Vasko</a>.</li></ul><h2>Good first issues</h2><p>Ever wanted to contribute to SwiftWasm projects, but unsure where to start? Here's a list of issues that could be suitable for beginners:</p><ul><li><a href="https://github.com/swiftwasm/swift/issues/29">swiftwasm/swift#29</a>: Fix compile error on test cases depending on platform</li><li><a href="https://github.com/swiftwasm/carton/issues/203">swiftwasm/carton#203</a>: Allow launching a specific browser with <code>carton test</code></li><li><a href="https://github.com/swiftwasm/carton/issues/201">swiftwasm/carton#201</a>: Correctly handle failure to launch browser process while testing</li><li><a href="https://github.com/swiftwasm/carton/issues/199">swiftwasm/carton#199</a>: <code>--enable-test-discovery</code> is now deprecated</li><li><a href="https://github.com/swiftwasm/carton/issues/193">swiftwasm/carton#193</a>: Add <code>--host</code> option to <code>carton dev</code> and <code>carton test</code></li><li><a href="https://github.com/TokamakUI/Tokamak/issues/350">TokamakUI/Tokamak</a>: Set up code coverage reports on GitHub Actions</li></ul><h2>Documentation</h2><h3>SwiftWasm book</h3><p>We're working on tracking down all the possible edge cases when porting code from other platforms in <a href="https://book.swiftwasm.org/">the SwiftWasm book</a>. Previously we were asked how to port code that depends on the <code>Darwin</code> module on Apple platforms or <code>Glibc</code> on Linux. We recommend using the <code>WASILibc</code> module, which obviously somewhat differs from libc on other platforms. We've added <a href="https://book.swiftwasm.org/getting-started/libc.html">a corresponding note clarifying this</a> to the book.</p><h2>Toolchain</h2><p>As the Swift team already announced <a href="https://forums.swift.org/t/swift-5-4-release-process/41936">the release process for the 5.4 version</a>, we started preparing our corresponding SwiftWasm 5.4 release. The <a href="https://github.com/swiftwasm/swift/tree/swiftwasm-release/5.4"><code>swiftwasm-release/5.4</code></a> branch in our fork now <a href="https://github.com/swiftwasm/swift/pull/2380">tracks the upstream <code>release/5.4</code> branch</a>, as we plan to tag our own 5.4.0 later this year.</p><p>Additionally, we made sure that the fork of our toolchain <a href="https://github.com/swiftwasm/swift/pull/2405">can be compiled on Apple Silicon Macs</a>. While GitHub Actions doesn't provide CI agents for the M1 architecture, the SwiftWasm toolchain can be built locally for Apple Silicon, and we hope to provide a prebuilt distribution archive for it in some future release.</p><h3>Experimental async/await support</h3><p><a href="https://github.com/kateinoigakukun">@kateinoigakukun</a> enabled <a href="https://github.com/swiftwasm/swift/pull/2408">experimental concurrency support in SwiftWasm</a> and fixed several issues that previously prevented us from enabling <code>async</code>/<code>await</code> in development snapshots. Currently, starting with <a href="https://github.com/swiftwasm/swift/releases/tag/swift-wasm-DEVELOPMENT-SNAPSHOT-2021-01-02-a">swift-wasm-DEVELOPMENT-SNAPSHOT-2021-01-02-a</a>, the toolchain only supports a single-threaded task executor. This executor is suitable for usage in standalone WASI hosts such as Wasmer or Wasmtime. Unfortunately, it blocks the JavaScript event loop until all jobs are completed, and is unable to run any jobs created after the first event loop cycle. While this makes it unsuitable for JavaScript environments, we were able to work around that in JavaScriptKit as discussed in the next section.</p><h2>Libraries</h2><h3>JavaScriptKit</h3><p><a href="https://github.com/kateinoigakukun">@kateinoigakukun</a> started implementing <a href="https://github.com/swiftwasm/JavaScriptKit/pull/112">a Swift concurrency task executor</a> integrated with the JavaScript event loop. There are still several issues, but it's working well as a proof of concept. This experimental API allows us to utilize <code>async</code>/<code>await</code> in SwiftWasm apps for browsers and Node.js like this:</p><pre><code><span class="splash-keyword">import</span> JavaScriptEventLoop
<span class="splash-keyword">import</span> JavaScriptKit

<span class="splash-type">JavaScriptEventLoop</span>.<span class="splash-call">install</span>()
<span class="splash-keyword">let</span> fetch = <span class="splash-type">JSObject</span>.<span class="splash-property">global</span>.<span class="splash-property">fetch</span>.<span class="splash-property">function</span>!.<span class="splash-keyword">async

func</span> printZen() <span class="splash-keyword">async</span> {
  <span class="splash-keyword">let</span> result = <span class="splash-keyword">try</span>! <span class="splash-keyword">await</span> <span class="splash-call">fetch</span>(<span class="splash-string">"https://api.github.com/zen"</span>).<span class="splash-property">object</span>!
  <span class="splash-keyword">let</span> text = <span class="splash-keyword">try</span>! <span class="splash-keyword">await</span> result.<span class="splash-property">asyncing</span>.<span class="splash-property">text</span>!()
  <span class="splash-call">print</span>(text)
}

<span class="splash-type">JavaScriptEventLoop</span>.<span class="splash-call">runAsync</span> {
  <span class="splash-keyword">await</span> <span class="splash-call">printZen</span>()
}
</code></pre><h3>WebAssembly Micro Runtime</h3><p><a href="https://github.com/kateinoigakukun">@kateinoigakukun</a> published <a href="https://github.com/swiftwasm/wamr-swift">a Swift WebAssembly runtime package</a> powered by <a href="https://github.com/bytecodealliance/wasm-micro-runtime">the WebAssembly Micro Runtime project</a> (WAMR). This allows us to remove Wasmer dependency from <code>carton</code> and embed the WebAssembly runtime in the <code>carton</code> binary for use in commands such as <code>carton test</code>.</p><p>We were also able to test this package on Apple Silicon and submit <a href="https://github.com/bytecodealliance/wasm-micro-runtime/pull/480">a PR upstream</a> to make it work.</p><h3>DOMKit</h3><p>Our long-term goal is to make <a href="https://github.com/swiftwasm/DOMKit">DOMKit</a> the recommended library for type-safe interactions with Web APIs in SwiftWasm. While it's still at an early stage, we've updated it to <a href="https://github.com/swiftwasm/DOMKit/pull/3">JavaScriptKit 0.9 and added support for <code>globalThis</code></a>. <a href="https://github.com/swiftwasm/DOMKit/pull/4">In a separate PR</a> we've cleaned up unused code and fixed an event handlers crash.</p><h3>Tokamak</h3><p>With enough changes to warrant a new release, we've published <a href="https://github.com/TokamakUI/Tokamak/releases/tag/0.6.0">Tokamak 0.6.0</a>, which introduced support for the <code>Image</code> view loading images bundled as SwiftPM resources, implemented by <a href="https://github.com/j-f1">@j-f1</a>. It also adds the <code>PreferenceKey</code> protocol and related modifiers. developed by <a href="https://github.com/carson-katri">@carson-katri</a>.</p><p>Since then we've also added <a href="https://github.com/TokamakUI/Tokamak/pull/328">the <code>PreviewProvider</code> protocol</a>, <a href="https://github.com/TokamakUI/Tokamak/pull/329">an implementation of <code>TextEditor</code></a>, and updated our <a href="https://github.com/TokamakUI/Tokamak/pull/332">example code in <code>README.md</code> for script injection</a>. Additionally, a contribution from <a href="https://github.com/foscomputerservices">David Hunt</a> <a href="https://github.com/TokamakUI/Tokamak/pull/331">added missing typealiases to TokamakDOM</a> that should improve compatibility with SwiftUI, while <a href="https://github.com/j-f1">Jed Fox</a> removed <a href="https://github.com/TokamakUI/Tokamak/pull/341">redundant <code>path</code> element from SVG output</a>.</p><h2>Developer tools</h2><h3><code>carton</code></h3><p>We'd like to welcome <a href="https://github.com/thecb4">@thecb4</a>, who is the latest addition to the <code>carton</code> maintainers team! Thanks to his work, <a href="https://github.com/swiftwasm/carton/pull/191">project targets were restructured for better testability</a>, and now <a href="https://github.com/swiftwasm/carton/pull/198"><code>test</code></a>, <a href="https://github.com/swiftwasm/carton/pull/196"><code>dev</code>, and <code>bundle</code></a> commands are covered with end-to-end tests.</p><p>There's <a href="https://github.com/swiftwasm/carton/pull/195">ongoing work</a> to integrate <a href="https://github.com/swiftwasm/wamr-swift">the WAMR package</a> mentioned above with the <code>carton test</code> command. Also, <code>carton</code> now <a href="https://github.com/swiftwasm/carton/pull/189">correctly handles system target dependencies in <code>Package.swift</code></a>.</p><p>On top of that, stack traces from Chrome and Safari are <a href="https://github.com/swiftwasm/carton/pull/186">now supported in <code>carton dev</code> with proper symbol demangling</a>, thanks to the work by <a href="https://github.com/j-f1">@j-f1</a>. Additionally, <a href="https://github.com/yonihemi">@yonihemi</a> submitted <a href="https://github.com/swiftwasm/carton/pull/194">a PR which integrates <code>carton</code> with libSwiftPM</a> allowing us to reuse its model types.</p><p>Most of these changes were included in <a href="https://github.com/swiftwasm/carton/releases/tag/0.9.0">0.9.0</a> and <a href="https://github.com/swiftwasm/carton/releases/tag/0.9.1">0.9.1</a> releases published in December.</p><h3><code>webidl2swift</code></h3><p><a href="https://github.com/Apodini/webidl2swift"><code>webidl2swift</code></a> is the foundation on which our <a href="https://github.com/swiftwasm/DOMKit/">DOMKit</a> framework is built. Web API across all browsers is specified in <a href="https://en.wikipedia.org/wiki/Web_IDL">the Web IDL format</a>, which can then be parsed to generate type-safe bindings in Swift. The parser doesn't support all IDL files out there yet, but we've <a href="https://github.com/Apodini/webidl2swift/pull/10">updated dependencies and updated the code generator</a> to certain JavaScriptKit types that previously were deprecated.</p><h3>WasmTransformer</h3><p>There were a few changes to <a href="https://github.com/swiftwasm/WasmTransformer">the WasmTransformer package</a>, which we use in <code>carton</code> and intend to use in a few other dev tools. Specifically, we've <a href="https://github.com/swiftwasm/WasmTransformer/pull/12">generalized section info parsing</a> across different transformers, <a href="https://github.com/swiftwasm/WasmTransformer/pull/14">implemented a basic section size profiler</a>, and <a href="https://github.com/swiftwasm/WasmTransformer/pull/15">made the <code>TypeSection</code> type public</a> to make it easier to analyze sections of WebAssembly binaries.</p><h3>Gravity</h3><p>We're excited to announce our new developer tool enabled by WasmTransformer. <a href="https://github.com/swiftwasm/gravity">Gravity</a> is a binary code size profiler for WebAssembly built with WasmTransformer, <a href="https://developer.apple.com/xcode/swiftui/">SwiftUI</a>, and <a href="https://github.com/pointfreeco/swift-composable-architecture/">TCA</a>. It's an application for macOS that allows you to open a WebAssembly binary and view the size of different sections. Contents of some of the sections is also parsed for further analysis.</p><h2>Contributions</h2><p>A lot of our progress with SwiftWasm wouldn't be possible without payments from our GitHub Sponsors. Their contribution is deeply appreciated and allows us to spend more time on SwiftWasm projects. You can see the list of sponsors and make your contribution on <a href="https://github.com/sponsors/swiftwasm">our SwiftWasm organization sponsorship page</a>, or personal sponsorship pages of <a href="https://github.com/sponsors/carson-katri">Carson Katri</a>, <a href="https://github.com/sponsors/kateinoigakukun">Yuta Saito</a> and <a href="https://github.com/sponsors/MaxDesiatov">Max Desiatov</a>.</p><p>Thanks for reading! ðŸ‘‹</p></div></article></div><footer><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>